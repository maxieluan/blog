---
title: "Java, Node and golang，某种概览"
date: 2023-07-29T01:25:32+08:00
draft: false
tags: ["node.js", "golang", "java"]
categories: ["技术总览"]
description: "这是一篇从一个外行视角，对Java, Node.js, golang的看法和比较。"
author: "Max"
keywords: ["Java", "Node.js", "golang", "并发模型"]
featured: 
  flag: true
  weight: 1
---
## 初见
网上看到一些奇怪的观点和暴论并不罕见。今日在网上看到一初学者对Node.js的并发能力的质疑。此人写了一个非常简单的hello world程序，然后对node和java版本进行压力测试。之后得出结论，认为node的并发能力是网络炒作。

此类观点我是不认同的。但是这背后的原理却值得一些调查和思考。这里我将从一个外行的角度，对java, node, golang的并发模型进行一些比较和分析。

## 所谓并发对服务器的影响
高并发，就是说当大量请求同时到达服务器，竞争服务器资源，导致服务器压力暴增。鉴于服务器类型不同，资源种类不同，所谓高并发对服务器的影响也不尽相同。但是，总的来说，高并发对服务器的影响可以归纳为以下几点：

* CPU使用率
* 连接池
* 内存
* 线程和内存

关于线程和内存。在多线程应用中，每个并发的请求都会被分配一个线程。线程是操作系统分配的资源。当并发过大时，系统可能无力创造更多线程，因此造成系统瓶颈。

不同类型的编程模型对服务器资源的影响也不尽相同。在下一节中，我将讨论常用服务器，容器和编程语言的并发模型，以及它们如何与关键资源交互。

## 语言
### Java
Java是一个常用的，灵活的语言。它通常编译后运行在虚拟机中，也就是JVM。JVM能够让一个程序在不同的操作系统上运行。

在服务器编程中，Java程序通常运行在Servlet容器中。如Apache Tomcat。传统上，Tomcat通过线程池来管理连接，每个连接都由一个单独的线程来处理。然而，线程池的数量并不是无限的。线程池的最大线程数由线程池的配置决定。当连接数超过最大线程数时，服务器将其放入队列，直到线程可用。如果队列已满，服务器将拒绝连接。

当线程池大小增加以容纳更多连接时，某些限制将出现。每个线程都会消耗内存。线程池的大幅增加可能会使JVM的内存占用量升高。在应用程序计算量较轻的情况下，服务器可能会在达到CPU瓶颈之前遇到内存不足的错误。

### Node.js的事件驱动模型
与Java不同，Node.js通过事件驱动模型来处理并发。

当请求到达Node.js应用程序时，它们被添加一个callback然后放入队列中。event loop会逐个处理这些请求。异步操作，如文件访问，网络调用或数据库操作，也以非阻塞的方式处理，使事件循环能够在等待这些操作的回调时处理其他请求。

与传统的多线程模型不同，Node.js不会为每个连接生成额外的线程，这有助于节省内存，并允许应用程序充分利用CPU的处理能力，而不受线程管理开销的限制。

现代服务器通常具有多核，多线程的CPU。Node.js的单线程模型使开发人员能够部署多个Node.js实例，每个实例处理一个单独的核心，有效地利用多核CPU的计算能力。

虽然Node.js的事件驱动模型在处理高并发时具有显着优势，但他也有局限性。正如强调的那样，当处理需要太多处理时间的CPU密集型任务时，Node.js可能不如其他模型高效。如果每个任务都需要CPU运行很长时间却不怎么涉及IO，事件循环可能会被阻塞。它不会像多线程模型那样高效。

### golang
在服务器端编程中，Golang不能忽视。它有一个独特的并发模型，与Java和Node.js都不同。它不像单线程的Node.js，也不像多线程的Java。它介于两者之间。

Golang使用一种称为goroutine的概念来处理并发。goroutine是由Go运行时管理的轻量级线程。与线程不同，goroutine不绑定到特定的操作系统线程。相反，它可以多路复用到少量的操作系统线程上运行。这种独特的N：N调度模型允许goroutine在不增加线程管理开销的情况下创建和销毁，实现高度的并发。

作为一种静态类型的语言，Golang也被编译成机器码，这比Java的字节码更高效。它也有一个垃圾收集器，可以自动管理内存，这与Java类似。它在处理CPU密集型任务方面的性能非常出色，有时甚至可以与C或C++媲美。

## 为什么不是所有的项目都使用Golang
### Golang
Golang的速度，效率和性能引人深思，我们为什么不在所有项目中使用它。虽然Golang具有许多优点，但一些问题会让人们望而却步。

首先，语言的复杂性。与其他一些语言不同，Golang需要手动管理goroutine和同步。它没有泛型或异常。数组是固定长度的。这意味着开发人员需要手动管理其大小。这些都是性能的副产品。是双刃剑。

对于商业项目，速度对市场的影响可能是一个优先考虑的因素，Golang的复杂性可能会成为一个障碍。为了实现敏捷的开发周期，雇主可能需要雇佣更有经验的开发人员，这可能是一种代价高昂的解决方案。相比之下，选择其他效率低下的语言可能只需要几个额外的服务器来处理相同数量的流量，这是一种更具成本效益的解决方案。

这就是为什么Golang通常用于特定的场景，比如高性能应用程序，或者需要高并发的应用程序。例如，像Docker和Kubernetes这样的容器是用Golang编写的。一些公司使用golang来编写不需要频繁更新的关键系统。

### Java
Java在企业世界和主要的互联网公司中占据着主导地位。

首先，Java悠久的历史为其在企业世界的普及做出了贡献。Java拥有丰富的库和框架生态系统。这些代码库和现有的应用程序都是历史遗留问题，使得切换到另一种语言变得不切实际。

企业喜欢控制和可预测性。通过在JVM中运行Java应用程序，他们可以控制运行应用程序所需的硬件和软件规范。他们知道需要多少硬件才能最优地支持他们的用户群。

### Node.js
毫无疑问，Javascript的数量可能是Node.js流行的最大原因。你可以找到几乎任何东西的库。使它成为快速原型和开发的理想选择。

## 总结
这阵子，随着微服务的兴起，你可能会发现一些服务是用javascript开发的，一些是用Java开发的，一些是用PHP开发的，甚至是用Erlang开发的。他们都运行在用Golang编写的容器和编排器中。

这些语言都有自己的优点和缺点。

做开发一定要记住，不存在完美的语言。

哪个语言更好不是应该关心的问题，更重要的是要明白，你当前的场景下，哪个语言更适合。
